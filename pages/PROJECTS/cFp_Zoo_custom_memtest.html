

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.5.3.2.2. cFp_Memtest &mdash; cloudFPGA v0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.5.3.2.3. cFp Harris Corner Detection" href="cFp_Zoo_vision_harris.html" />
    <link rel="prev" title="5.5.3.2.1. cFp Uppercase" href="cFp_Zoo_custom_uppercase.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> cloudFPGA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../INTRODUCTION/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OVERVIEW/overview.html">2. Overview of cloudFPGA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GETTING_STARTED/getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CFSPHERE/cfsphere.html">4. The cloudFPGA Sphere</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cfprojects.html">5. Project repository</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cfprojects.html#about-cf-projects">5.1. About cF Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="cfprojects.html#getting-started-with-a-cf-project">5.2. Getting started with a cF project</a></li>
<li class="toctree-l2"><a class="reference internal" href="cfprojects.html#how-to-cfcreate">5.3. How to cFCreate</a></li>
<li class="toctree-l2"><a class="reference internal" href="cfprojects.html#how-to-create-a-project-in-the-cf-organization">5.4. How to create a project in the cF organization</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="cfprojects.html#project-repositories">5.5. Project Repositories</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cFp_HelloKale.html">5.5.1. cFp_HelloKale</a></li>
<li class="toctree-l3"><a class="reference internal" href="cFp_HelloThemisto.html">5.5.2. cFp_HelloThemisto</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="cFp_Zoo.html">5.5.3. cFp_Zoo</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cFp_Zoo_overview.html">5.5.3.1. cFp_Zoo Overview</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="cFp_Zoo_projects.html">5.5.3.2. cFp_Zoo Projects</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="cFp_Zoo_custom_uppercase.html">5.5.3.2.1. cFp Uppercase</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">5.5.3.2.2. cFp_Memtest</a></li>
<li class="toctree-l5"><a class="reference internal" href="cFp_Zoo_vision_harris.html">5.5.3.2.3. cFp Harris Corner Detection</a></li>
<li class="toctree-l5"><a class="reference internal" href="cFp_Zoo_quantitative_finance_mceuropean_engine.html">5.5.3.2.4. cFp Monte Carlo European Pricing Engine</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/contributing.html">6. How to Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">cloudFPGA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="cfprojects.html"><span class="section-number">5. </span>Project repository</a> &raquo;</li>
        
          <li><a href="cFp_Zoo.html"><span class="section-number">5.5.3. </span>cFp_Zoo</a> &raquo;</li>
        
          <li><a href="cFp_Zoo_projects.html"><span class="section-number">5.5.3.2. </span>cFp_Zoo Projects</a> &raquo;</li>
        
      <li><span class="section-number">5.5.3.2.2. </span>cFp_Memtest</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/pages/PROJECTS/cFp_Zoo_custom_memtest.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cfp-memtest">
<span id="project-cfp-custom-uppercase"></span><h1><span class="section-number">5.5.3.2.2. </span>cFp_Memtest<a class="headerlink" href="#cfp-memtest" title="Permalink to this headline">¶</a></h1>
<p><strong>Note:</strong> <a class="reference external" href="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/README.md">This HTML section is rendered based on the Markdown file in cFp_Zoo.</a></p>
<p>cloudFPGA project (cFp) for changing characters case of a user phrase. The purpose of this project
is to establish a starting point for a full-stack software developer with a usefull API for common
programming languanges and development frameworks.</p>
<a class="reference external image-reference" href="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/cFp_Memtest.png?raw=true"><img alt="Oveview of cFp_Memtest" src="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/cFp_Memtest.png?raw=true" /></a>
<div class="section" id="system-configurattion">
<h2><span class="section-number">5.5.3.2.2.1. </span>System configurattion<a class="headerlink" href="#system-configurattion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ubuntu">
<h3><span class="section-number">5.5.3.2.2.1.1. </span>Ubuntu<a class="headerlink" href="#ubuntu" title="Permalink to this headline">¶</a></h3>
<p>Assuming Ubuntu &gt;16.04 the folowing packages should be installed:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="n">build</span><span class="o">-</span><span class="n">essential</span><span class="w"> </span><span class="n">pkg</span><span class="o">-</span><span class="n">config</span><span class="w"> </span><span class="n">libxml2</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">rename</span><span class="w"> </span><span class="n">rpl</span><span class="w"> </span><span class="n">python3</span><span class="o">-</span><span class="n">dev</span><span class="w"> </span><span class="n">python3</span><span class="o">-</span><span class="n">venv</span><span class="w"> </span><span class="n">swig</span><span class="w"> </span><span class="n">curl</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="centos-el7">
<h3><span class="section-number">5.5.3.2.2.1.2. </span>CentOS/EL7<a class="headerlink" href="#centos-el7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>sudo yum groupinstall &#39;Development Tools&#39;
sudo yum install cmake
</pre></div>
</div>
</div>
</div>
<div class="section" id="full-stack-software-support">
<h2><span class="section-number">5.5.3.2.2.2. </span>Full-stack software support<a class="headerlink" href="#full-stack-software-support" title="Permalink to this headline">¶</a></h2>
<p>The following programming languanges are currently supported (and are on the roadmap)</p>
<ul class="simple">
<li><p>[x] C/C++</p></li>
<li><p>[ ] Java</p></li>
<li><p>[ ] Python</p></li>
<li><p>[ ] Javascript</p></li>
</ul>
<p>The following programming frameworks are currently supported (and are on the roadmap)</p>
<ul class="simple">
<li><p>[ ] <a class="reference external" href="https://jupyter.org/">Jupyter Notebook / Jupyter Lab</a></p></li>
<li><p>[ ] <a class="reference external" href="https://spark.apache.org/">Spark</a></p></li>
</ul>
<p>The following socket libraries are currently supported (and are on the roadmap)</p>
<ul class="simple">
<li><p>[x] <a class="reference external" href="http://cs.ecs.baylor.edu/~donahoo/practical/CSockets/practical/">Practical Sockets</a></p></li>
<li><p>[ ] <a class="reference external" href="https://think-async.com/Asio/">Asio</a></p></li>
<li><p>[ ] <a class="reference external" href="https://zeromq.org/">ZeroMQ</a></p></li>
<li><p>[ ] <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">WebSockets</a></p></li>
</ul>
<p>The following containerization software is currently supported (and is on the roadmap)</p>
<ul class="simple">
<li><p>[ ] <a class="reference external" href="www.docker.com">Docker</a></p></li>
<li><p>[ ] <a class="reference external" href="https://kubernetes.io/">Kubernetes</a></p></li>
<li><p>[ ] <a class="reference external" href="https://www.okd.io/">Red Hat OpenShift Community Distribution of Kubernetes</a></p></li>
</ul>
</div>
<div class="section" id="vivado-tool-support">
<h2><span class="section-number">5.5.3.2.2.3. </span>Vivado tool support<a class="headerlink" href="#vivado-tool-support" title="Permalink to this headline">¶</a></h2>
<p>The versions below are supported by cFp_Memtest. As of today we follow a hybrid development approach
where a specific part of <code class="docutils literal notranslate"><span class="pre">SHELL</span></code> code is synthesized using <code class="docutils literal notranslate"><span class="pre">Vivado</span> <span class="pre">2017.4</span></code>, while the rest of the
HLS, Synthesis, P&amp;R and bitgen are carried over with <code class="docutils literal notranslate"><span class="pre">Vivado</span> <span class="pre">2019.x</span></code>.</p>
<div class="section" id="for-the-shell-cfdk-s-code">
<h3><span class="section-number">5.5.3.2.2.3.1. </span>For the SHELL (cFDK’s code)<a class="headerlink" href="#for-the-shell-cfdk-s-code" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>[x] 2017</p>
<ul>
<li><p>[x] 2017.4</p></li>
</ul>
</li>
<li><p>[ ] 2018</p></li>
<li><p>[ ] 2019</p></li>
<li><p>[ ] 2020</p></li>
</ul>
</div>
<div class="section" id="for-the-role-user-s-code">
<h3><span class="section-number">5.5.3.2.2.3.2. </span>For the ROLE (user’s code)<a class="headerlink" href="#for-the-role-user-s-code" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>[ ] 2017</p></li>
<li><p>[ ] 2018</p></li>
<li><p>[x] 2019</p>
<ul>
<li><p>[x] 2019.1</p></li>
<li><p>[x] 2019.2</p></li>
</ul>
</li>
<li><p>[x] 2020</p>
<ul>
<li><p>[x] 2020.1</p></li>
</ul>
</li>
</ul>
<div class="section" id="repository-and-environment-setup">
<h4><span class="section-number">5.5.3.2.2.3.2.1. </span>Repository and environment setup<a class="headerlink" href="#repository-and-environment-setup" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recursive-submodules git@github.com:cloudFPGA/cFp_Vitis.git
<span class="nb">cd</span> cFp_Vitis
<span class="nb">source</span> ./env/setenv.sh
</pre></div>
</div>
</div>
<div class="section" id="memtest-simulation">
<h4><span class="section-number">5.5.3.2.2.3.2.2. </span>Memtest Simulation<a class="headerlink" href="#memtest-simulation" title="Permalink to this headline">¶</a></h4>
<p>The testbench is offered in two flavors:</p>
<ul>
<li><p>HLS TB: The testbench of the C++/RTL. This is a typical Vivado HLS testbench but it includes the testing of Memtest IP when this is wrapped in a <a class="reference external" href="https://pages.github.com/cloudFPGA/Doc/pages/cfdk.html#the-themisto-sra">cF Themisto Shell</a>.</p></li>
<li><p>Host TB: This includes the testing of a a host apllication (C++) that send/receives strings over Ethernet (TCP/UDP) with a cF FPGA. This testbench establishes a socket-based connection with an intermediate listener which further calls the previous testbench. So practically, the 2nd tb is a wrapper of the 1st tb, but passing the I/O data over socket streams.
For example this is the <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">command</span></code> inside <code class="docutils literal notranslate"><span class="pre">Host</span> <span class="pre">TB</span></code> that calls the <code class="docutils literal notranslate"><span class="pre">HLS</span> <span class="pre">TB</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Calling the actual TB over its typical makefile procedure, but passing the save file</span>
<span class="n">string</span><span class="w"> </span><span class="n">str_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cd ../../../../../../ROLE/custom/hls/memtest/ &amp;&amp; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clean_cmd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\</span>
<span class="s">INPUT_STRING=4096 TEST_NUMBER=2 BURST_SIZE=512 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exec_cmd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &amp;&amp; \</span>
<span class="s">cd ../../../../../../HOST/custom/memtest/languages/cplusplus/build/ &quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_command</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span><span class="w"></span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Calling TB with command:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<p>The Makefile pass as argument to the TB the following params:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">INPUT_STRING</span></code> is the maxmimum target address (e.d., max 1000000 or 1MB)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEST_NUMBER</span></code> is the number of repetitions of the test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BURST_SIZE</span></code> is the desired burst size</p></li>
</ol>
<div class="section" id="simulation-example">
<h5><span class="section-number">5.5.3.2.2.3.2.2.1. </span>Simulation example:<a class="headerlink" href="#simulation-example" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">csim</span> <span class="pre">INPUT_STRING=4096</span> <span class="pre">TEST_NUMBER=2</span> <span class="pre">BURST_SIZE=512</span></code></p>
<p>Basic files/modules:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/HOST/custom/memtest/languages/cplusplus/src/memtest_host.cpp">memtest_host.cpp</a>: The end-user application. This is the application that a user can execute on a x86 host and send a string to the FPGA for processing with Memtest function. This file is part of both the <code class="docutils literal notranslate"><span class="pre">HLS</span> <span class="pre">TB</span></code> and the <code class="docutils literal notranslate"><span class="pre">Host</span> <span class="pre">TB</span></code></p></li>
<li><p><a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/HOST/custom/memtest/languages/cplusplus/src/memtest_host_fwd_tb.cpp">memtest_host_fw_tb.cpp</a>: The intermediate listener for socket connections from an end-user application. This file is part only of the <code class="docutils literal notranslate"><span class="pre">Host</span> <span class="pre">TB</span></code>.</p></li>
<li><p><a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/test/test_memtest.cpp">test_memtest.cpp</a>: The typical Vivado HLS testbench of Memtest IP, when this is wrapped in a Themisto Shell.</p></li>
<li><p><a class="reference external" href="https://pages.github.com/cloudFPGA/Doc/pages/cfdk.html#the-themisto-sra">Themisto Shell</a>: The SHELL-ROLE architecture of cF.</p></li>
<li><p><a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis">cFp_Memtest</a>: The project that bridges Memtest libraries with cF.</p></li>
</ol>
<p><strong>Note:</strong> Remember to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> every time you change those definitions.</p>
<div class="section" id="memory-test-modularity">
<h6><span class="section-number">5.5.3.2.2.3.2.2.1.1. </span>Memory test modularity<a class="headerlink" href="#memory-test-modularity" title="Permalink to this headline">¶</a></h6>
<p>Modularity of the memory test:</p>
<ol class="arabic simple">
<li><p><cite>``src/memtest.cpp`</cite> &lt;<a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/src/memtest.cpp">https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/src/memtest.cpp</a>&gt;`_ contains the <strong>TOP</strong> module where you may find the three coarse grained stage: Port&amp;Dst//RX - Processing - TX</p></li>
<li><p><cite>``include/memtest.hpp`</cite> &lt;<a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest.cpp">https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest.cpp</a>&gt;`_ is the <strong>TOP</strong> level <strong>HEADER</strong> with some info on the most basic <strong>COMMANDS</strong> such as a <strong>start/stop</strong> for a controllable execution</p></li>
<li><p><cite>``include/memtest_library.hpp`</cite> &lt;<a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest_library.hpp">https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest_library.hpp</a>&gt;`_ contains the <strong>library</strong> for some <strong>basic cF</strong> components: Port&amp;Dst, RX, TX, Memory R/W utilities, Performance counter utilities</p></li>
<li><p><cite>``include/memtest_processing.hpp`</cite> &lt;<a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest_processing.hpp">https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest_processing.hpp</a>&gt;`_ contains a <strong>template structure</strong> of a <strong>processing</strong> function for the cF environment for a start/stop approach with commands management, processing, and output management. There are example of processing functions for the memory test</p></li>
<li><p><cite>``include/memtest_pattern_library.hpp`</cite> &lt;<a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest_pattern_library.hpp">https://github.com/cloudFPGA/cFp_Vitis/blob/master/ROLE/custom/hls/memtest/include/memtest_pattern_library.hpp</a>&gt;`_ contains the functions used to developed the <strong>custom processing</strong> algorithm of the memory test: pattern generator functions, read functions, write functions.</p></li>
</ol>
<p>A developer might replace the command handling, and the processing with their own one.
To this extent, the modifications are minimal and referred mostly to the processing functions.</p>
</div>
<div class="section" id="run-simulation">
<h6><span class="section-number">5.5.3.2.2.3.2.2.1.2. </span>Run simulation<a class="headerlink" href="#run-simulation" title="Permalink to this headline">¶</a></h6>
<p><strong>HLS TB</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ./ROLE/custom/hls/memtest/
make fcsim -j <span class="m">4</span>  <span class="c1"># to run simulation using your system&#39;s gcc (with 4 threads)</span>
make csim   <span class="c1"># to run simulation using Vivado&#39;s gcc</span>
make cosim  <span class="c1"># to run co-simulation using Vivado</span>
</pre></div>
</div>
<p><strong>Optional steps</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ./ROLE/custom/hls/memtest/
make callgraph <span class="c1"># to run fcsim and then execute the binary in Valgrind&#39;s callgraph tool</span>
make kcachegrind <span class="c1"># to run callgrah and then view the output in Kcachegrind tool</span>
make memcheck <span class="c1"># to run fcsim and then execute the binary in Valgrind&#39;s memcheck tool (to inspect memory leaks)</span>
</pre></div>
</div>
<p><strong>Host TB</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compile sources</span>
<span class="nb">cd</span> ./HOST/custom/memtest/languages/cplusplus
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake ../
make -j <span class="m">2</span>

<span class="c1"># Start the intermediate listener</span>
<span class="c1"># Usage: ./memtest_host_fwd_tb &lt;Server Port&gt; &lt;optional simulation mode&gt;</span>
./memtest_host_fwd_tb <span class="m">1234</span> <span class="m">0</span>

<span class="c1"># Start the actual user application on host</span>
<span class="c1"># Open another terminal and prepare env</span>
<span class="nb">cd</span> cFp_Memtest
<span class="nb">source</span> ./env/setenv.sh
./HOST/custom/memtest/languages/cplusplus/build
<span class="c1"># Usage: ./memtest_host &lt;Server&gt; &lt;Server Port&gt; &lt;number of address to test&gt; &lt;testing times&gt; &lt;burst size&gt; &lt;optional list/interactive mode (type list or nothing)&gt;</span>
./memtest_host <span class="m">10</span>.12.200.153 <span class="m">1234</span> <span class="m">4096</span> <span class="m">2</span> <span class="m">512</span>
<span class="c1">#interactive mode</span>
<span class="c1"># You should expect the output in the stdout and a log in a csv file for both average results and single tests</span>
./memtest_host <span class="m">10</span>.12.200.153 <span class="m">1234</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> list
<span class="c1"># benchmarking mode, running for a fixed number of times the benchmark from the biggest burst size to the shortest</span>
<span class="c1"># on incremental number of addresses</span>

<span class="c1"># What happens is that the user application (memtest_host) is sending an input string to</span>
<span class="c1"># intermediate listener (memtest_host_fwd_tb) through socket. The latter receives the payload and</span>
<span class="c1"># reconstructs the string. Then it is calling the HLS TB by firstly compiling the HLS TB files. The</span>
<span class="c1"># opposite data flow is realized for taking the results back and reconstruct the FPGA output string.</span>
<span class="c1"># You should expect the string output in the stdout.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="memtest-synthesis">
<h4><span class="section-number">5.5.3.2.2.3.2.3. </span>Memtest Synthesis<a class="headerlink" href="#memtest-synthesis" title="Permalink to this headline">¶</a></h4>
<p>Since curretnly the cFDK supports only Vivado(HLS) 2017.4 we are following a 2-steps synthesis
procedure. Firstly we synthesize the Themisto SHELL with Vivado (HLS) 2017.4 and then we synthesize
the rest of the project (including P&amp;R and bitgen) with Vivado (HLS) &gt; 2019.1.</p>
<p>By default the Memory Test will come with <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">SIMPLER_BANDWIDTH_TEST</span></code> commented. Which means that you will use the complex memory test that can handle any variable burst size.
To change this just decomment the define.</p>
<div class="section" id="the-themisto-shell">
<h5><span class="section-number">5.5.3.2.2.3.2.3.1. </span>The Themisto SHELL<a class="headerlink" href="#the-themisto-shell" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> cFp_Vitis/cFDK/SRA/LIB/SHELL/Themisto
make all <span class="c1"># with Vivado HLS == 2017.4</span>
</pre></div>
</div>
</div>
<div class="section" id="the-complete-cfp-memtest">
<h5><span class="section-number">5.5.3.2.2.3.2.3.2. </span>The complete cFp_Memtest<a class="headerlink" href="#the-complete-cfp-memtest" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> cFp_Vitis
make monolithic <span class="c1"># with Vivado HLS &gt;= 2019.1</span>
</pre></div>
</div>
<p>Optional HLS only for the Memtest IP (e.g. to check synthesizability)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> cFp_Vitis/ROLE/custom/hls/memtest/
make csynth <span class="c1"># with Vivado HLS &gt;= 2019.1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="memtest-cf-demo">
<h4><span class="section-number">5.5.3.2.2.3.2.4. </span>Memtest cF Demo<a class="headerlink" href="#memtest-cf-demo" title="Permalink to this headline">¶</a></h4>
<p>TODO: Flash a cF FPGA node with the generated bitstream and note down the IP of this FPGA node. e.g. assuming <code class="docutils literal notranslate"><span class="pre">10.12.200.153</span></code> and port <code class="docutils literal notranslate"><span class="pre">2718</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ./HOST/custom/memtest/languages/cplusplus/
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake ../
make -j <span class="m">2</span>
<span class="c1"># Usage: ./memtest_host &lt;Server&gt; &lt;Server Port&gt; &lt;number of address to test&gt; &lt;testing times&gt; &lt;burst size&gt; &lt;optional list/interactive mode (type list or nothing)&gt;</span>
./memtest_host <span class="m">10</span>.12.200.153 <span class="m">2718</span> <span class="m">4096</span> <span class="m">2</span> <span class="m">512</span>
<span class="c1">#interactive mode</span>
<span class="c1"># You should expect the output in the stdout and a log in a csv file for both average results and single tests</span>
./memtest_host <span class="m">10</span>.12.200.153 <span class="m">2718</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> list
<span class="c1"># benchmarking mode, running for a fixed number of times the benchmark from the biggest burst size to the shortest</span>
<span class="c1"># on incremental number of addresses</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> The cFp_Memtest ROLE (FPGA part) is equipped with both the UDP and TCP offload engines. At
runtime, on host, to select one over the other, you simply need to change in <a class="reference external" href="https://github.com/cloudFPGA/cFp_Vitis/blob/master//HOST/custom/memtest/languages/cplusplus/include/config.h">config.h</a>
file the define <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">NET_TYPE</span> <span class="pre">udp</span></code> (choose either udp or tcp).</p>
<div class="section" id="jupyterlab-example">
<h5><span class="section-number">5.5.3.2.2.3.2.4.1. </span>JupyterLab example<a class="headerlink" href="#jupyterlab-example" title="Permalink to this headline">¶</a></h5>
<p>NOT UP TO DATE</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> HOST/langauges/python
mkdir build
<span class="nb">cd</span> build
cmake ../
make -j <span class="m">2</span>
python3 -m venv env     <span class="c1"># to create a local dev environment</span>
                        <span class="c1"># note you will have a &quot;env&quot; before the prompt to remind</span>
                        <span class="c1"># you the local environment you work in</span>
<span class="nb">source</span> env/bin/activate <span class="c1">#</span>
pip3 install -r ../requirements.txt <span class="c1"># to be improved : some errors might occur depending on environment</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="usefull-commands">
<h4><span class="section-number">5.5.3.2.2.3.2.5. </span>Usefull commands<a class="headerlink" href="#usefull-commands" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Connect to ZYC2 network through openvpn:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">openvpn</span> <span class="pre">--config</span> <span class="pre">zyc2-vpn-user.ovpn</span> <span class="pre">--auth-user-pass</span> <span class="pre">up-user</span></code></p>
</li>
<li><p>Connect to a ZYC2 x86 node:</p>
<p><code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-Y</span> <span class="pre">ubuntu&#64;10.12.2.100</span></code></p>
</li>
<li><p>On Wireshark filter line:</p>
<p><code class="docutils literal notranslate"><span class="pre">udp.port==2718</span></code> or <code class="docutils literal notranslate"><span class="pre">tcp.port==2718</span></code></p>
</li>
<li><p>Quick bitgen:</p>
<p>sometimes it accelerates the build process of <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">monolithic</span></code> if:
execute after a successfull build <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">save_mono_incr</span></code> and then build the new with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">monolithic_incr</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">monolithic_debug_incr</span></code></p>
</li>
<li><p>Docker:
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">distracted_ishizaka</span> <span class="pre">/bin/bash</span></code></p></li>
<li><p>Possible resources/stack limitation on Linux-based systems:
<code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-a</span></code> to see the current limitations
<code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-c</span> <span class="pre">unlimited</span></code> to unlimit  “The maximum size of core files created”
<code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-s</span> <span class="pre">unlimited</span></code> to unlimit “The maximum stack size.”</p></li>
</ul>
</div>
<div class="section" id="working-with-zyc2">
<h4><span class="section-number">5.5.3.2.2.3.2.6. </span>Working with ZYC2<a class="headerlink" href="#working-with-zyc2" title="Permalink to this headline">¶</a></h4>
<p>All communication goes over the <em>UDP/TCP port 2718</em>. Hence, the CPU should run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./memtest_host &lt;Server&gt; &lt;Server Port&gt; &lt;input string&gt;
</pre></div>
</div>
<p>The packets will be send from Host (CPU) Terminal 1 to FPGA and they will be received back in the
same terminal by a single host application using the <code class="docutils literal notranslate"><span class="pre">sendTo()</span></code> and <code class="docutils literal notranslate"><span class="pre">receiveFrom()</span></code> socket methods.</p>
<p>For more details, <code class="docutils literal notranslate"><span class="pre">tcpdump</span> <span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span> <span class="pre">-nn</span> <span class="pre">-s0</span> <span class="pre">-vv</span> <span class="pre">-X</span> <span class="pre">port</span> <span class="pre">2718</span></code> could be helpful.</p>
<p>The <em>Role</em> can be replicated to many FPGA nodes in order to create a pipline of processing.
Which destination the packets will have is determined by the <code class="docutils literal notranslate"><span class="pre">node_id</span></code>/<code class="docutils literal notranslate"><span class="pre">node_rank</span></code> and <code class="docutils literal notranslate"><span class="pre">cluster_size</span></code>
(VHDL ports<code class="docutils literal notranslate"><span class="pre">piFMC_ROLE_rank</span></code> and <code class="docutils literal notranslate"><span class="pre">piFMC_ROLE_size</span></code>).</p>
<p>The <a href="#id2"><span class="problematic" id="id3">**</span></a>Role can be configured to forward the packet always to <code class="docutils literal notranslate"><span class="pre">(node_rank</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">%</span> <span class="pre">cluster_size</span></code>**
(for UDP and TCP packets), so this example works also for more or less then two FPGAs, actually.
curretnly, the default example supports one CPU node and one FPGA node.</p>
<p>For distributing the routing tables, <a href="#id4"><span class="problematic" id="id5">**</span></a><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/cluster</span></code>** must be used.
The following depicts an example API call, assuming that the cFp_Memtest bitfile was uploaded as
image<code class="docutils literal notranslate"><span class="pre">d8471f75-880b-48ff-ac1a-baa89cc3fbc9</span></code>:</p>
<a class="reference external image-reference" href="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/post_cluster.png?raw=true"><img alt="POST /cluster example" src="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/post_cluster.png?raw=true" /></a>
</div>
</div>
</div>
<div class="section" id="firewall-issues">
<h2><span class="section-number">5.5.3.2.2.4. </span>Firewall issues<a class="headerlink" href="#firewall-issues" title="Permalink to this headline">¶</a></h2>
<p>Some firewalls may block network packets if there is not a connection to the remote machine/port.
Hence, to get the Triangle example to work, the following commands may be necessary to be executed
(as root):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">$</span><span class="w"> </span><span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span><span class="w"> </span><span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="k">public</span><span class="w"> </span><span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">2718-2750</span><span class="o">/</span><span class="n">udp</span><span class="w"> </span><span class="o">--</span><span class="n">permanent</span><span class="w"></span>
<span class="n">$</span><span class="w"> </span><span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span><span class="w"> </span><span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="k">public</span><span class="w"> </span><span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">2718-2750</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="o">--</span><span class="n">permanent</span><span class="w"></span>
<span class="n">$</span><span class="w"> </span><span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span><span class="w"> </span><span class="o">--</span><span class="n">reload</span><span class="w"></span>
</pre></div>
</div>
<p>Also, ensure that the network secuirty group settings are updated (e.g. in case of the ZYC2 OpenStack).</p>
</div>
<div class="section" id="memory-test-results">
<h2><span class="section-number">5.5.3.2.2.5. </span>Memory test Results<a class="headerlink" href="#memory-test-results" title="Permalink to this headline">¶</a></h2>
<p>Follows some expected outputs of the memory test in the simple (i.e., free running) and the complex version (i.e., burst controlled).
First some analysis of the burst controlled bandwidth for the read and the write.
Analyzing power of two memory sizes starting from 64 bytes (i.e., one 512bits word)</p>
<div class="section" id="bandwidth-burst-control-results">
<h3><span class="section-number">5.5.3.2.2.5.1. </span>Bandwidth Burst Control Results<a class="headerlink" href="#bandwidth-burst-control-results" title="Permalink to this headline">¶</a></h3>
<p>Burst: 1 – &gt; 512 (power of two)</p>
<ol class="arabic">
<li><p>Read</p></li>
<li><p>Write
#### Bandwidth write results variable burst sizes</p>
<a class="reference external image-reference" href="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/membw_write.png?raw=true"><img alt="Memory Test Bandwidth Write Results" src="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/membw_write.png?raw=true" /></a>
<p>#### Bandwidth read results variable burst sizes</p>
<a class="reference external image-reference" href="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/membw_read.png?raw=true"><img alt="Memory Test Bandwidth Read Results" src="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/membw_read.png?raw=true" /></a>
</li>
</ol>
</div>
<div class="section" id="bandwidth-read-and-write-results-comparison-simple-and-complex-memory-tests-i-e-free-running-vs-burst-cntrlled">
<h3><span class="section-number">5.5.3.2.2.5.2. </span>Bandwidth read and write results comparison simple and complex memory tests (i.e. free-running vs burst cntrlled)<a class="headerlink" href="#bandwidth-read-and-write-results-comparison-simple-and-complex-memory-tests-i-e-free-running-vs-burst-cntrlled" title="Permalink to this headline">¶</a></h3>
<a class="reference external image-reference" href="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/membw_performance_scaling_new.png?raw=true"><img alt="Memory Test Bandwidth comparison simple and complex" src="https://github.com/cloudFPGA/cFp_Zoo/blob/master/ROLE/custom/hls/memtest/../../../../doc/membw_performance_scaling_new.png?raw=true" /></a>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cFp_Zoo_vision_harris.html" class="btn btn-neutral float-right" title="5.5.3.2.3. cFp Harris Corner Detection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cFp_Zoo_custom_uppercase.html" class="btn btn-neutral float-left" title="5.5.3.2.1. cFp Uppercase" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, cloudFPGA

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>